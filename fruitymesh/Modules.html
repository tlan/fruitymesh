<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modules Overview :: Fruitymesh</title>
  <link rel="canonical" href="http://mwaylabs.github.io/fruitymesh/fruitymesh/Modules.html">
  <meta name="generator" content="Antora 2.1.1">
  <link rel="stylesheet" href="../_/css/site.css">
  <link rel="stylesheet" href="../_/css/footer.css">
</head>

<body class="article">
  <header class="header" role="banner">
<header class="header" role="banner">
  <div class="navbar-top">
    <a class="navbar-logo" id="fruitymesh-logo-padding" href="https://mwaylabs.github.io/fruitymesh/fruitymesh/index.html">
      <div class="navbar-item">
        <img src="../_/img/fruitymesh_logo.png" alt="Fruitymesh">
      </div>
    </a>
    <div class="navbar-item">
      <div id="search-wrapper" class="border-color-fruitymesh>
        <input id="search-input" type="text" placeholder="Search...">
      </div>
    </div>
  </div>
  <nav class="navbar-bottom fruitymesh-header-color">
    <a href="https://github.com/mwaylabs/fruitymesh">
      <div class="navbar-item">Fruitymesh on Github</div>
    </a>
  </nav>
</header>

</header>
  <div class="main-wrapper">
<div class="navigation-container" data-component="" data-version="master">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <button class="navigation-toggle"></button>
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Quick-Start.html">Quick Start</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="BasicUsage.html">Basic Usage</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Concepts.html">Concepts</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Features.html">Features</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Specification.html">Specification</a>
      </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Developers</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Developers.html">Developer Overview</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Class-Structure.html">Class Structure</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Debugging.html">Debugging</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ModuleDocumentationTemplate.html">Module Documentation Template</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="BuildingWithCMake.html">Building with CMake</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VsCodeSetup.html">VsCode Setup</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="CppCheck.html">CppCheck Setup</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Mesh</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Node.html">Node</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Connections.html">Connections</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Core Functionality</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="AdvertisingController.html">AdvertisingController</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="BoardConfig.html">Board Configuration</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="FruityHal.html">FruityHal</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Logger.html">Logger</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="RawData.html">RawData Protocol</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="RecordStorage.html">Record Storage</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ScanController.html">ScanController</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="SensorsAndActuators.html">Sensors and Actuators</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Terminal.html">Terminal</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Modules</span>
    <ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="Modules.html">Module Overview</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="AdvertisingModule.html">AdvertisingModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="DebugModule.html">DebugModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="DfuModule.html">DfuModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="EnrollmentModule.html">EnrollmentModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="IoModule.html">IoModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="MeshAccessModule.html">MeshAccessModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ScanningModule.html">ScanningModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="StatusReporterModule.html">StatusReportModule</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Simulator</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="CherrySim.html">CherrySim</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Measurements</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Battery-Consumption.html">Battery Consumption</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Throughput.html">Throughput</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">The Fruitymesh Algorithm</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="The-FruityMesh-Algorithm.html">The Fruitymesh Algorithm Basics</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="The-Algorithm-in-Detail.html">The Algorithm in Detail</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Tutorials</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Tutorials.html">Tutorial Overview</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Implementing-a-Custom-Module.html">Implementing a Custom Module</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="FAQ.html">FAQ</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="FAQ.html">FAQ</a>
      </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<article class="doc"><a name="section-top"></a>
<h1>Modules Overview</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>FruityMesh consists of a number of different modules. There are the core modules which are part of the open source distribution, which deliver standard functionality. Also, there are other modules, some developed by us or by other developers that can provide specific functionality and built on our mesh framework.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_general"><a class="anchor" href="#_general"></a>General</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All modules share a set of commands for loading and retrieving their configuration, for activating and deactivating them and for triggering actions.</p>
</div>
<div class="paragraph">
<p>Each custom module should extend the <em>Module</em> class to have a set of methods that it can override. Some of these methods are explained below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Module Constructor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The constructor must only define variables and should not start any functionality.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConfigurationLoadedHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This handler is called once the module should be initialized. A pointer to the configuration will be given and all initialization should happen in this method. If the module configuration says that the module is inactive, the module should not initialize any functionality.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimerEventHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will be called at a fixed interval for all Modules. If functionality should only be executed e.g. each 5 seconds, use the SHOULD_IV_TRIGGER macro in the handler.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TerminalCommandHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will receive all terminal input that can then be checked against a list of commands to execute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ButtonHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Called once a button has been pressed and released.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MeshMessageReceivedHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will be called once a full message has been received over the mesh (e.g. after all message parts were reassembled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BleEventHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement this to receive all other ble events that have not been preprocessed, such as received advertising packets, new connections, e.g.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PreEnrollmentHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a module to e.g. enroll an attached controller before accepting the enrollment. Check the <a href="EnrollmentModule.html" class="page">EnrollmentModule</a> for more info.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RecordStorageEventHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When saving a record, this handler is called once the flash access was done. Check the <a href="RecordStorage.html" class="page">RecordStorage</a> documentation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CheckMeshAccessPacketAuthorization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="MeshAccessModule.html" class="page">MeshAccessModule</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CheckComponentUpdateRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement to ask a 3rd party controller about compatibility with the Dfu.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StartComponentUpdate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Called once the Dfu image is ready and can be sent to a 3rd party controller.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Commands are given with arguments in brackets <strong>[arg]</strong>. These must be entered by the user. Arguments in curly brackets <strong>{arg}</strong> are optional.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_module_configuration"><a class="anchor" href="#_module_configuration"></a>Module Configuration</h3>
<div class="paragraph">
<p>Sends a new module configuration to any node.
The resulting binary configuration will be copied to the
modulen configuration of the specified module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">set_config [nodeID | "this"] [module-name] [hex-string] {requestHandle}

//Set binary configuration for io module
set_config 0 io 06:01:01:00:00 0</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_request_module_configuration"><a class="anchor" href="#_request_module_configuration"></a>Request Module Configuration</h3>
<div class="paragraph">
<p>Prints the configuration of a specific module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Display the current module configuration, shorthand notation is: getconf
get_config [nodeID  | "this"] [module name]

//Print the configuration from the current node's advertising module
get_config this adv</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_activate_deactivate_module_at_runtime"><a class="anchor" href="#_activate_deactivate_module_at_runtime"></a>Activate &amp; Deactivate Module At Runtime</h3>
<div class="paragraph">
<p>Activates or deactivates a specific module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Activate or deactivate a module, shorthand notation is: setactive
set_active [nodeID | "this"] [module name] [on | off]

//Examples
set_active 0 scan on //activates the scan module
set_active 0 adv off //deactivates the advertising module</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once received, the message is replied by the following message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
    "nodeId":2,
    "type":"set_active_result",
    "module":6,
    "requestHandle":0,
    "code":0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where "code" can have one of the following values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUCCESS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NO_CONFIGURATION, the module was activate/deactivated but it was impossible to save the state as the module seems to have no configuration. (Report this to a firmware developer if it ever happens.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NO_SUCH_MODULE, the given module does not exists.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RECORD_STORAGE_ERROR, the module does exist and does have a configuration but the record storage was unable to save the config. The best course of action is probably to try again later as the node seems to be busy right now.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_commands"><a class="anchor" href="#_module_commands"></a>Module Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most module commands are structured in the same way.
You have to give the nodeId that should process the command, specify the
module and a command that should be triggered.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Trigger some module action, shorthand notation is: action
action [nodeID  | "this"] [module name] [command]

//Examples
action 0 io led on //Switch on the LED for all connected nodes
action this io led off //Switch off LEDs for the current node
action 0 status get_device_info //Get the device info of all nodes
action 123 status get_status //Get the current status from node 123</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_open_source_modules"><a class="anchor" href="#_open_source_modules"></a>Open Source Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following modules are currently part of the
open source release:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="AdvertisingModule.html" class="page"><em>AdvertisingModule</em> (<em>ModuleId</em> 1)</a></p>
</li>
<li>
<p><a href="ScanningModule.html" class="page"><em>ScanningModule</em> (<em>ModuleId</em> 2)</a></p>
</li>
<li>
<p><a href="StatusReporterModule.html" class="page"><em>StatusReporterModule</em> (<em>ModuleId</em> 3)</a></p>
</li>
<li>
<p><a href="EnrollmentModule.html" class="page"><em>EnrollmentModule</em> (<em>ModuleId</em> 5)</a></p>
</li>
<li>
<p><a href="IoModule.html" class="page"><em>IoModule</em> (<em>ModuleId</em> 6)</a></p>
</li>
<li>
<p><a href="DebugModule.html" class="page"><em>DebugModule</em> (<em>ModuleId</em> 7)</a></p>
</li>
<li>
<p><a href="MeshAccessModule.html" class="page"><em>MeshAccessModule</em> (<em>ModuleId</em> 10)</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proprietary_modules"><a class="anchor" href="#_proprietary_modules"></a>Proprietary Modules</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="DfuModule.html" class="page"><em>DfuModule</em> (<em>ModuleId</em> 4)</a></p>
</li>
<li>
<p>EnOcean, Eink, Asset and other prorietory modules can be provided upon
request.</p>
</li>
</ul>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
  <h3 class="toc-title">Modules Overview</h3>
  <div id="article-toc"></div>
</aside>
  </main>
</div>
  <footer class="footer fruitymesh-footer-padding">
<p>This project is under active development at the <a href="http://www.mwaysolutions.com/" >M-Way Solutions GmbH,</a> Germany.</p>
<p>We use FruityMesh ourselves in conjunction with our custom MeshGateway to build services such as connected lights, asset tracking and much more for our customers.</p>
</footer>
<script type="text/javascript">
  window.antora = window.antora || {}
  window.antora.basePath = '..'
  window.antora.pagePath = '/fruitymesh/Modules.html'
</script>
<script src="../_/js/site.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js"></script>
<script src="../_/js/vendor/search.js"></script>
<script async src="../_/../search-index.js"></script>
<script src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/zoom.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script>
  tocbot.init({
    tocSelector: '#article-toc',
    contentSelector: 'article',
    headingSelector: 'h2, h3, h4, h5, h6',
    collapseDepth: 6,
    positionFixedSelector: '#article-toc',
    scrollSmooth: true,
  });
  var tocList = document.getElementById('article-toc').getElementsByClassName('toc-list');
  if (tocList && tocList.length > 0 && tocList[0].childNodes.length > 0) {
    document.getElementById('article-toc').parentNode.classList.remove('hidden');
  }
</script>
</body>

</html>
