<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Features :: Fruitymesh</title>
  <link rel="canonical" href="http://mwaylabs.github.io/fruitymesh/fruitymesh/Features.html">
  <meta name="generator" content="Antora 2.1.1">
  <link rel="stylesheet" href="../_/css/site.css">
  <link rel="stylesheet" href="../_/css/footer.css">
</head>

<body class="article">
  <header class="header" role="banner">
<header class="header" role="banner">
  <div class="navbar-top">
    <a class="navbar-logo" id="fruitymesh-logo-padding" href="https://mwaylabs.github.io/fruitymesh/fruitymesh/index.html">
      <div class="navbar-item">
        <img src="../_/img/fruitymesh_logo.png" alt="Fruitymesh">
      </div>
    </a>
    <div class="navbar-item">
      <div id="search-wrapper" class="border-color-fruitymesh>
        <input id="search-input" type="text" placeholder="Search...">
      </div>
    </div>
  </div>
  <nav class="navbar-bottom fruitymesh-header-color">
    <a href="https://github.com/mwaylabs/fruitymesh">
      <div class="navbar-item">Fruitymesh on Github</div>
    </a>
  </nav>
</header>

</header>
  <div class="main-wrapper">
<div class="navigation-container" data-component="" data-version="master">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <button class="navigation-toggle"></button>
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Quick-Start.html">Quick Start</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="BasicUsage.html">Basic Usage</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Concepts.html">Concepts</a>
      </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="Features.html">Features</a>
      </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Specification.html">Specification</a>
      </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Developers</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Developers.html">Developer Overview</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Class-Structure.html">Class Structure</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Debugging.html">Debugging</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="DocumentationTemplate.html">Documentation Template</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Mesh</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Node.html">Node</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Connections.html">Connections</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Modules</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Modules.html">Module Overview</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="AdvertisingModule.html">AdvertisingModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="DebugModule.html">DebugModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="DfuModule.html">DfuModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="EnrollmentModule.html">EnrollmentModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="IoModule.html">IoModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="MeshAccessModule.html">MeshAccessModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ScanningModule.html">ScanningModule</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="StatusReporterModule.html">StatusReportModule</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Simulator</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Simulator.html">Old Simulator</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="CherrySim.html">CherrySim</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Other Classes</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="AdvertisingController.html">AdvertisingController</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="FruityHal.html">FruityHal</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Logger.html">Logger</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="RecordStorage.html">Record Storage</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ScanController.html">ScanController</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Measurements</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Battery-Consumption.html">Battery Consumption</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Throughput.html">Throughput</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">The Fruitymesh Algorithm</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="The-FruityMesh-Algorithm.html">The Fruitymesh Algorithm Basics</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="The-Algorithm-in-Detail.html">The Algorithm in Detail</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Tutorials</span>
    <ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Tutorials.html">Tutorial Overview</a>
      </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Implementing-a-Custom-Module.html">Implementing a Custom Module</a>
      </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="FAQ.html">FAQ</a>
      </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<article class="doc"><a name="section-top"></a>
<h1>Features</h1>
<div class="sect1">
<h2 id="_mesh_features"><a class="anchor" href="#_mesh_features"></a>Mesh Features</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Automatic meshing and self-healing capabilities with <a href="The-FruityMesh-Algorithm.html" class="page">The FruityMesh Algorithm</a></p>
</li>
<li>
<p>Enrollment (Provisioning) of nodes both directly and over the mesh, e.g. using a QR code or with the "nearby" feature (see <a href="EnrollmentModule.html" class="page">EnrollmentModule</a>)</p>
</li>
<li>
<p><a href="MeshAccessModule.html" class="page">MeshAccessModule</a> for handling connections from/to smartphones and other devices</p>
</li>
<li>
<p>Encrypted mesh and smartphone connections by default using node (device), organization and multiple user keys (see <a href="Specification.html#EncryptionKeys" class="page">Encryption Keys</a>)</p>
</li>
<li>
<p>Automatic time synchronisation over the mesh (cf. <a href="#_time_synchronisation">Time Synchronisation</a>)</p>
</li>
<li>
<p>Automatic packet splitting if packets are bigger than the connection MTU (<a href="#_packet_splitting">Packet Splitting</a>)</p>
</li>
<li>
<p><a href="#_sink_determination">Sink Determination</a> allows us to detect a Gateway in our Mesh</p>
</li>
<li>
<p><a href="#_connection_reestablishment">Connection Reestablishment</a> in case a GAP connection drops, with automatic packet resending</p>
</li>
<li>
<p>Low <a href="Battery-Consumption.html" class="page">Battery Consumption</a></p>
</li>
<li>
<p>Integrated message queuing</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_features"><a class="anchor" href="#_additional_features"></a>Additional Features</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>UART Terminal to execute commands with a list of arguments for manual or automated communication with a MeshGateway (cf. <a href="BasicUsage.html" class="page">Basic Usage</a>)</p>
</li>
<li>
<p>Modular structure with persistent module configurations (cf. <a href="Modules.html" class="page">Modules</a>)</p>
</li>
<li>
<p><a href="RecordStorage.html" class="page">RecordStorage</a>, a record based file system for storing data in flash that is always reliable</p>
</li>
<li>
<p>Automatic cycling of different advertising messages with the <a href="AdvertisingController.html" class="page">AdvertisingController</a></p>
</li>
<li>
<p>Multiplexing of different ScanJobs using the <a href="ScanController.html" class="page">ScanController</a></p>
</li>
<li>
<p>Runtime <a href="BoardConfig.html" class="page">Board Configurations</a> so that the same firmware can run on multiple boards</p>
</li>
<li>
<p>Using <a href="Developers.html#Featuresets" class="page">Featuresets</a>, you can easily compile different firmware configurations from the same source code</p>
</li>
<li>
<p>Predefined <a href="Specification.html#UICR" class="page">UICR</a> structure that allows easy production of nodes with different serial numbers and settings</p>
</li>
<li>
<p>Small and highly optimized firmware size. It is modular and can be easily configured through the featureset</p>
</li>
<li>
<p>Abstraction from the BLE stack using our <a href="FruityHal.html" class="page">FruityHal</a></p>
</li>
<li>
<p>Lots of source code comments and easily understandable method and variable names (see source code ;-))</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reliability_debugging"><a class="anchor" href="#_reliability_debugging"></a>Reliability &amp; Debugging</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="#_watchdog_with_safe_boot_mode">Watchdog With Safe Boot Mode</a> to really make sure that the nodes will always be running</p>
</li>
<li>
<p><a href="Logger.html" class="page">Debug Logger</a> with support for filtering log tags during runtime</p>
</li>
<li>
<p>Support for <a href="Logger.html" class="page">UART logging and Segger RTT logging</a>, also at the same time</p>
</li>
<li>
<p><a href="Logger.html#ErrorLog" class="page">Error Log</a> and <a href="StatusReporterModule.html#LiveReports" class="page">Live Error Reporting</a> for logging and retrieving errors in production setups</p>
</li>
<li>
<p>No heap usage for more reliability</p>
</li>
<li>
<p>Automatic logging of the <a href="Node.html#RebootMessage" class="page">reboot reason</a> and reporting over the mesh</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_features"><a class="anchor" href="#_module_features"></a>Module Features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is only an extract of the different features of the Modules. Make sure to take a look at the <a href="Modules.html" class="page">Modules</a> documentation and at the documentation of the different modules themselves.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="AdvertisingModule.html" class="page">AdvertisingModule</a> for configuring custom broadcast messages such as EddyStone or iBeacon</p>
</li>
<li>
<p><a href="DebugModule.html" class="page">DebugModule</a> to send test packets, flood the network, ping nodes, &#8230;&#8203;</p>
</li>
<li>
<p><a href="EnrollmentModule.html" class="page">EnrollmentModule</a> for provisioning nodes (locally or over an existing mesh) and giving them access to a mesh</p>
</li>
<li>
<p><a href="IoModule.html" class="page">IoModule</a> for signalling commands using LEDs or other pins</p>
</li>
<li>
<p><a href="StatusReporterModule.html" class="page">StatusReporterModule</a> for monitoring the nodes</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_closed_source_features"><a class="anchor" href="#_closed_source_features"></a>Closed Source Features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A number of modules of FruityMesh are not yet open source but can be used by customers. Contact us if you are interested.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="DfuModule.html" class="page">DfuModule</a> firmware updates over the mesh. Not limited to FruityMesh, but also available for connected 3rd party controllers</p>
</li>
<li>
<p><a href="#bluerange-firmware:ROOT:AssetModule.adoc" class="page unresolved">AssetModule</a>: Broadcasting of asset telemetry messages that can be located indoors by our infrastructure</p>
</li>
<li>
<p>A number of <a href="Tutorials.html" class="page">custom modules</a> and customization of FruityMesh have already been implemented for many customers.</p>
</li>
<li>
<p>A number of drivers, customized to work with FruityMesh</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_upcoming_features"><a class="anchor" href="#_upcoming_features"></a>Upcoming Features</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CherrySim</p>
<div class="ulist">
<ul>
<li>
<p>Compilation of FruityMesh for x86 together with a simulator that abstracts the hardware and can simulate hundreds of nodes at the same time.</p>
</li>
<li>
<p>Integrated testing suite to write tests against a mesh of multiple nodes that can all run with different featuresets.</p>
</li>
<li>
<p>Provides the ability to Mock 3rd Party hardware.</p>
</li>
<li>
<p><span class="image"><img src="_images/cherrysim.png" alt="cherrysim"></span></p>
</li>
</ul>
</div>
</li>
<li>
<p>Flow Control &amp; Quality of Service (QoS)</p>
<div class="ulist">
<ul>
<li>
<p>As an enhancement to our connections, we are planning to add Flow Control and QoS to better deal with throughput peaks and manage packet priorities</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_features_in_detail"><a class="anchor" href="#_features_in_detail"></a>Features in Detail</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_time_synchronisation"><a class="anchor" href="#_time_synchronisation"></a>Time Synchronisation</h3>
<div class="paragraph">
<p>FruityMesh has inbuilt time synchronization. A gateway or smartphone can act as a synchronisation device to send a unix timestamp to one node in the mesh. This node will then take care that this timestamp is synchronized to all other nodes in the mesh. If any number of nodes are rebooted, the time will be synchronized again if there is at least one node that still has the current time. By using a counter value, we make sure that the latest timestamp will be synchronized and that the time can be corrected in both directions. The time is always synchronized between two partners in a kind of handshake where first the time is sent to the other node and next, an offset is sent to account for the delay in sending that message. Further documentation can be found <a href="Node.html#TimeSynchronization" class="page">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_packet_splitting"><a class="anchor" href="#_packet_splitting"></a>Packet Splitting</h3>
<div class="paragraph">
<p>Depending on the configuration of the nodes in a network, the connection MTU (Maximum Transmission Unit) might only allow for a packet size of 20 bytes payload. As you will probably need to send bigger packets from time to time, we implemented automatic packet splitting. A packet can be queued with a size of up to 200 bytes and is then split automatically before it is sent to the next node at which point it is automatically reassembled. This process also makes sure that a packet uses the maximum possible MTU available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sink_determination"><a class="anchor" href="#_sink_determination"></a>Sink Determination</h3>
<div class="paragraph">
<p>Once we attach a Gateway to the Mesh, we might want to send messages on a direct route to that Gateway. Or maybe, we simply want to know if a Gateway is currently available in the mesh. Sink determination determines the number of hops to the Gateway on each node.
During clustering, a new node performs a handshake with its partner node and exchanges information about the network structure. This includes the cluster size and also the master bit that is used to determine which cluster must dissolve if a connection is lost. This handshake also includes the number of hops to the sink (MeshGateway). This information is also included in the clusterInfoUpdate packets that notify all nodes about changes in the network.</p>
</div>
<div class="paragraph">
<p>If a sink is available through a connection, the number of hops to this sink will be sent with these packets. The sink itself has 0 hops to the sink. If there is no sink available, it is denoted with -1.</p>
</div>
</div>
<div class="sect2">
<h3 id="_connection_reestablishment"><a class="anchor" href="#_connection_reestablishment"></a>Connection Reestablishment</h3>
<div class="paragraph">
<p>FruityMesh relies an standard BLE GAP connections which have a configurable interval and timeout. These can be chosen depending on the use-case for either high throughput or low power consumption. If a small timeout is chosen and the environment has high radio interference, it can happen that these GAP connections are disconnected. In these cases, there is an extended timeout in which FruityMesh will try to reestablish the GAP connection multiple times until it succeeds. Packets will stay in the queue and will be sent after the connection was reestablished. This means, that aside from a higher latency, no packet loss will occur.</p>
</div>
</div>
<div class="sect2">
<h3 id="_watchdog_with_safe_boot_mode"><a class="anchor" href="#_watchdog_with_safe_boot_mode"></a>Watchdog With Safe Boot Mode</h3>
<div class="paragraph">
<p>The hardware watchdog is configured to restart a node after a certain time if it doesn&#8217;t receive a keep alive packet from the gateway in the meantime. This is the last fallback to recover a node if there is some critical unknown issue. It is also possible to configure the Watchdog to work without a Gateway, it will then monitor the behaviour of the node itself.</p>
</div>
<div class="paragraph">
<p>It is possible to configure the watchdog to use safe boot. In safe boot mode, the node will boot up without loading any persistant configuration. This also means that the node will not be enrolled in this mode, but it will reboot in normal mode after the watchdog triggers again. This makes it possible to rescue a node that received a faulty persistent configuration.</p>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
  <h3 class="toc-title">Features</h3>
  <div id="article-toc"></div>
</aside>
  </main>
</div>
  <footer class="footer fruitymesh-footer-padding">
<p>This project is under active development at the <a href="http://www.mwaysolutions.com/" >M-Way Solutions GmbH,</a> Germany.</p>
<p>We use FruityMesh ourselves in conjunction with our custom MeshGateway to build services such as connected lights, asset tracking and much more for our customers.</p>
</footer>
<script type="text/javascript">
  window.antora = window.antora || {}
  window.antora.basePath = '..'
  window.antora.pagePath = '/fruitymesh/Features.html'
</script>
<script src="../_/js/site.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js"></script>
<script src="../_/js/vendor/search.js"></script>
<script async src="../_/../search-index.js"></script>
<script src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/zoom.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script>
  tocbot.init({
    tocSelector: '#article-toc',
    contentSelector: 'article',
    headingSelector: 'h2, h3, h4, h5, h6',
    collapseDepth: 6,
    positionFixedSelector: '#article-toc',
    scrollSmooth: true,
  });
  var tocList = document.getElementById('article-toc').getElementsByClassName('toc-list');
  if (tocList && tocList.length > 0 && tocList[0].childNodes.length > 0) {
    document.getElementById('article-toc').parentNode.classList.remove('hidden');
  }
</script>
</body>

</html>
